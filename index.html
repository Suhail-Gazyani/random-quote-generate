<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Random Quote Generator</title>
  <style>
    :root{--bg:#0f172a;--text:#e5e7eb;--muted:#94a3b8;--card:#0b1220;--accent:#22d3ee;--btn:#06b6d4;--ring:rgba(255,255,255,.08)}
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial}
    body{margin:0;min-height:100vh;color:var(--text);background:radial-gradient(1100px 500px at 80% -10%, rgba(34,211,238,.08), transparent), linear-gradient(180deg,#0b1021,#0b1021 60%, #060a14 100%);display:flex;align-items:center;justify-content:center;padding:28px}
    .wrap{width:100%;max-width:900px}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:14px}
    h1{margin:0;font-size:22px;letter-spacing:.2px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    select,input,button{accent-color:var(--btn)}
    select,input{background:transparent;border:1px solid var(--ring);color:inherit;padding:9px 10px;border-radius:10px}
    input{min-width:220px}
    button{background:var(--btn);color:#042023;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid var(--ring);color:var(--muted)}
    button:disabled{opacity:.6;cursor:not-allowed}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015)); border:1px solid var(--ring);border-radius:14px;padding:18px;box-shadow:0 12px 40px rgba(2,6,23,.45)}
    .quote{font-size:24px;line-height:1.6;min-height:96px}
    .author{margin-top:8px;color:var(--muted)}
    .meta{margin-top:8px;color:var(--muted);font-size:12px}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
    aside{height:100%;}
    .list{max-height:320px;overflow:auto;margin-top:8px}
    .fav{display:flex;justify-content:space-between;gap:10px;border:1px dashed var(--ring);padding:8px;border-radius:10px;margin-bottom:8px}
    .fav small{color:var(--muted)}
    .muted{color:var(--muted)}
    .hidden{display:none}
    .spinner{width:18px;height:18px;border:3px solid rgba(255,255,255,0.15);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (max-width:860px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>‚ú® Random Quote Generator</h1>
      <div class="row">
        <label class="muted">Tag
          <select id="tag">
            <option value="">Any</option>
            <option>inspirational</option>
            <option>life</option>
            <option>love</option>
            <option>wisdom</option>
            <option>happiness</option>
            <option>success</option>
            <option>friendship</option>
            <option>technology</option>
            <option>famous-quotes</option>
          </select>
        </label>
        <input id="search" placeholder="Keyword (optional)" />
        <button id="newBtn">New Quote</button>
        <button id="ttsBtn" class="ghost" title="Speak">üîä Speak</button>
        <button id="copyBtn" class="ghost" title="Copy">üìã Copy</button>
        <button id="tweetBtn" class="ghost" title="Tweet">üê¶ Tweet</button>
        <button id="saveBtn" class="ghost" title="Save to favorites">‚≠ê Save</button>
      </div>
    </header>

    <div class="grid">
      <main class="card">
        <div class="quote" id="quote">Click "New Quote" to begin!</div>
        <div class="author" id="author">‚Äî</div>
        <div class="meta" id="meta">
          <span id="tags">Tags: ‚Äî</span>
          <span> ‚Ä¢ </span>
          <span id="source">Source: ‚Äî</span>
          <span id="loading" class="hidden" style="margin-left:8px"><span class="spinner"></span> Loading‚Ä¶</span>
        </div>
        <div class="actions">
          <button id="copyAsImg" class="ghost" title="Copy as image">üñºÔ∏è Copy as image</button>
          <button id="downloadPng" class="ghost" title="Download image">‚¨áÔ∏è Download</button>
        </div>
        <canvas id="canvas" class="hidden"></canvas>
      </main>

      <aside>
        <div class="card">
          <div class="row" style="justify-content:space-between;align-items:center">
            <div class="muted">‚≠ê Favorites</div>
            <button id="clearFav" class="ghost" title="Clear favorites">üóëÔ∏è Clear</button>
          </div>
          <div class="list" id="favList"></div>
        </div>
      </aside>
    </div>

    <footer class="muted" style="margin-top:10px">Uses <code>Quotable</code> API with offline fallback. All client-side.</footer>
  </div>

<script>
(function(){
  const quoteEl = document.getElementById('quote');
  const authorEl = document.getElementById('author');
  const tagsEl = document.getElementById('tags');
  const sourceEl = document.getElementById('source');
  const loadingEl = document.getElementById('loading');
  const tag = document.getElementById('tag');
  const search = document.getElementById('search');
  const newBtn = document.getElementById('newBtn');
  const ttsBtn = document.getElementById('ttsBtn');
  const copyBtn = document.getElementById('copyBtn');
  const tweetBtn = document.getElementById('tweetBtn');
  const saveBtn = document.getElementById('saveBtn');
  const copyAsImgBtn = document.getElementById('copyAsImg');
  const downloadPngBtn = document.getElementById('downloadPng');
  const favList = document.getElementById('favList');
  const clearFav = document.getElementById('clearFav');
  const canvas = document.getElementById('canvas');

  const offlineQuotes = [
    {content:"The only way to do great work is to love what you do.", author:"Steve Jobs", tags:["inspirational","work"]},
    {content:"Life is 10% what happens to us and 90% how we react to it.", author:"Charles R. Swindoll", tags:["life","attitude"]},
    {content:"Your time is limited, don't waste it living someone else's life.", author:"Steve Jobs", tags:["life","inspirational"]},
    {content:"Happiness is not something ready made. It comes from your own actions.", author:"Dalai Lama", tags:["happiness","wisdom"]},
    {content:"If you want to go fast, go alone. If you want to go far, go together.", author:"African Proverb", tags:["friendship","wisdom"]},
    {content:"The secret of getting ahead is getting started.", author:"Mark Twain", tags:["success","inspirational"]},
    {content:"Talk is cheap. Show me the code.", author:"Linus Torvalds", tags:["technology","programming"]}
  ];

  function showLoading(yes){ loadingEl.classList.toggle('hidden', !yes); newBtn.disabled = !!yes; }

  function setQuote(q, meta){
    quoteEl.textContent = '‚Äú' + q.content + '‚Äù';
    authorEl.textContent = q.author ? '‚Äî ' + q.author : '‚Äî Unknown';
    tagsEl.textContent = 'Tags: ' + ((q.tags && q.tags.length)? q.tags.join(', ') : '‚Äî');
    sourceEl.textContent = 'Source: ' + (meta?.source || '‚Äî');
    saveBtn.textContent = '‚≠ê Save';
  }

  async function fetchFromQuotable(){
    // API: https://api.quotable.io/random?tags=wisdom&minLength=80&maxLength=140
    const params = new URLSearchParams();
    if(tag.value) params.set('tags', tag.value);
    if(search.value.trim()) params.set('query', search.value.trim());
    const url = 'https://api.quotable.io/random' + (params.toString()? ('?' + params.toString()):'');
    const res = await fetch(url);
    if(!res.ok) throw new Error('Quotable failed');
    const d = await res.json();
    return {content:d.content, author:d.author, tags:d.tags||[]};
  }

  async function getQuote(){
    showLoading(true);
    try{
      const q = await fetchFromQuotable();
      setQuote(q, {source:'Quotable'});
    }catch(e){
      const q = offlineQuotes[Math.floor(Math.random()*offlineQuotes.length)];
      setQuote(q, {source:'Offline list'});
    }finally{ showLoading(false); }
  }

  function speak(){
    const s = window.speechSynthesis; if(!s) return alert('Speech not supported.');
    s.cancel();
    const ut = new SpeechSynthesisUtterance(quoteEl.textContent + ' ' + authorEl.textContent);
    ut.rate=1; ut.pitch=1; ut.lang = navigator.language || 'en-US';
    s.speak(ut);
  }

  function copy(){
    navigator.clipboard.writeText(`${quoteEl.textContent} ${authorEl.textContent}`).then(()=>{
      copyBtn.textContent='‚úÖ Copied'; setTimeout(()=>copyBtn.textContent='üìã Copy',1200);
    }).catch(()=> alert('Copy failed'));
  }

  function tweet(){
    const text = encodeURIComponent(`${quoteEl.textContent} ${authorEl.textContent}`);
    const url = `https://twitter.com/intent/tweet?text=${text}`;
    window.open(url,'_blank');
  }

  // Favorites
  function getFavs(){ try{return JSON.parse(localStorage.getItem('rq_favs')||'[]')}catch(e){return []} }
  function setFavs(arr){ localStorage.setItem('rq_favs', JSON.stringify(arr)); }
  function currentQuoteObj(){
    return {content:quoteEl.textContent.replace(/^‚Äú|‚Äù$/g,''), author:authorEl.textContent.replace(/^‚Äî\s*/,''), tags: (tagsEl.textContent.replace(/^Tags:\s*/,'')) .split(',').map(s=>s.trim()).filter(Boolean)}
  }
  function renderFavs(){
    const favs = getFavs();
    favList.innerHTML='';
    if(!favs.length){ favList.innerHTML = '<div class="muted">No favorites yet.</div>'; return; }
    favs.forEach((q, i)=>{
      const div = document.createElement('div'); div.className='fav';
      const left = document.createElement('div');
      left.innerHTML = `<div>‚Äú${q.content}‚Äù</div><small>‚Äî ${q.author||'Unknown'}</small>`;
      const remove = document.createElement('button'); remove.className='ghost'; remove.textContent='‚úñ';
      remove.onclick = ()=>{ const a=getFavs(); a.splice(i,1); setFavs(a); renderFavs(); };
      div.appendChild(left); div.appendChild(remove);
      favList.appendChild(div);
    });
  }
  function saveFav(){
    const favs = getFavs();
    const q = currentQuoteObj();
    if(favs.some(f=>f.content===q.content && f.author===q.author)){
      saveBtn.textContent='‚úÖ Saved'; return;
    }
    favs.unshift(q); setFavs(favs); renderFavs(); saveBtn.textContent='‚úÖ Saved';
  }

  // Canvas image export
  function drawToCanvas(){
    const w = 1080, h = 1080; canvas.width=w; canvas.height=h; const ctx = canvas.getContext('2d');
    // background
    const grad = ctx.createLinearGradient(0,0,w,h); grad.addColorStop(0,'#0b1021'); grad.addColorStop(1,'#091427'); ctx.fillStyle = grad; ctx.fillRect(0,0,w,h);
    ctx.fillStyle = 'rgba(255,255,255,.1)';
    for(let i=0;i<6;i++){ ctx.beginPath(); ctx.arc(Math.random()*w, Math.random()*h, 120+Math.random()*120, 0, Math.PI*2); ctx.fill(); }
    // text
    const quote = quoteEl.textContent.replace(/^‚Äú|‚Äù$/g,'');
    const author = authorEl.textContent.replace(/^‚Äî\s*/, '');
    ctx.fillStyle = '#e5e7eb';
    ctx.font = 'bold 56px Inter, Arial';
    const lines = wrapText(ctx, '‚Äú'+quote+'‚Äù', w-200, 80);
    let y = 240; lines.forEach(l=>{ ctx.fillText(l, 100, y); y+=72; });
    ctx.font = '28px Inter, Arial'; ctx.fillStyle = '#94a3b8';
    ctx.fillText('‚Äî '+author, 100, y+24);
  }
  function wrapText(ctx, text, maxWidth, maxLines){
    const words = text.split(' '); const lines=[]; let line='';
    for(const word of words){
      const test = line? line+' '+word : word;
      if(ctx.measureText(test).width <= maxWidth){ line = test; }
      else{ lines.push(line); line = word; if(lines.length>=maxLines-1) break; }
    }
    if(line) lines.push(line);
    return lines;
  }
  async function copyAsImage(){ drawToCanvas(); try{ await navigator.clipboard.write([await canvasToClipboardItem(canvas)]); copyAsImgBtn.textContent='‚úÖ Copied'; setTimeout(()=>copyAsImgBtn.textContent='üñºÔ∏è Copy as image',1200);}catch(e){ alert('Copy as image failed. Try Download.'); } }
  function downloadPng(){ drawToCanvas(); const url = canvas.toDataURL('image/png'); const a=document.createElement('a'); a.href=url; a.download='quote.png'; a.click(); }
  async function canvasToClipboardItem(cv){ const blob = await new Promise(res=>cv.toBlob(res)); return new ClipboardItem({[blob.type]: blob}); }

  // events
  newBtn.addEventListener('click', getQuote);
  ttsBtn.addEventListener('click', speak);
  copyBtn.addEventListener('click', copy);
  tweetBtn.addEventListener('click', tweet);
  saveBtn.addEventListener('click', saveFav);
  clearFav.addEventListener('click', ()=>{ localStorage.removeItem('rq_favs'); renderFavs(); });
  copyAsImgBtn.addEventListener('click', copyAsImage);
  downloadPngBtn.addEventListener('click', downloadPng);

  // init
  renderFavs();
  getQuote();
})();
</script>
</body>
</html>
