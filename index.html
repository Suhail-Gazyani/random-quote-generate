<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Random Joke Generator</title>
  <style>
    :root{--bg:#0f172a;--panel:#111827;--card:#0b1220;--text:#e5e7eb;--muted:#94a3b8;--accent:#22d3ee;--btn:#06b6d4;--ok:#10b981;--warn:#f59e0b}
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial}
    body{margin:0;min-height:100vh;background:radial-gradient(1200px 600px at 80% -10%, rgba(34,211,238,.08), transparent), linear-gradient(180deg,#0b1021,#0b1021 60%, #060a14 100%);color:var(--text);display:flex;align-items:center;justify-content:center;padding:24px}
    .wrap{width:100%;max-width:860px}
    header{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-bottom:16px}
    h1{font-size:22px;margin:0;letter-spacing:0.2px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.015)); border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:18px;box-shadow:0 12px 40px rgba(2,6,23,.45)}
    .controls{display:flex;flex-wrap:wrap;gap:8px}
    select, button, input[type="checkbox"]{accent-color:var(--btn)}
    select{background:transparent;border:1px solid rgba(255,255,255,.08);color:inherit;padding:8px 10px;border-radius:10px}
    label.small{font-size:12px;color:var(--muted)}
    button{background:var(--btn);color:#042023;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--muted)}
    button:disabled{opacity:.6;cursor:not-allowed}
    .joke{font-size:22px;line-height:1.5;background:rgba(255,255,255,0.03);padding:16px;border-radius:10px;min-height:88px}
    .meta{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:13px;margin-top:8px}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .hidden{display:none}
    footer{margin-top:12px;color:var(--muted);font-size:12px}
    .spinner{width:18px;height:18px;border:3px solid rgba(255,255,255,0.15);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üòÇ Random Joke Generator</h1>
      <div class="controls">
        <div class="row">
          <label class="small">Category
            <select id="cat">
              <option value="Any">Any</option>
              <option value="Programming">Programming</option>
              <option value="Misc">Misc</option>
              <option value="Pun">Pun</option>
              <option value="Spooky">Spooky</option>
              <option value="Christmas">Christmas</option>
            </select>
          </label>
          <label class="small"><input id="safe" type="checkbox" checked> Safe-mode</label>
          <button id="newBtn">New Joke</button>
          <button id="ttsBtn" class="ghost" title="Speak">üîä Speak</button>
          <button id="copyBtn" class="ghost" title="Copy">üìã Copy</button>
          <button id="tweetBtn" class="ghost" title="Tweet">üê¶ Tweet</button>
        </div>
      </div>
    </header>

    <div class="card">
      <div class="joke" id="joke">Press "New Joke" to start!</div>
      <div class="meta" id="meta"><span id="source">Source: ‚Äî</span> <span>‚Ä¢</span> <span id="category">Category: ‚Äî</span> <span class="hidden" id="loading"><span class="spinner"></span> Loading‚Ä¶</span></div>
    </div>

    <footer>
      Uses <code>JokeAPI</code> and <code>icanhazdadjoke</code> with offline fallback.
    </footer>
  </div>

<script>
(function(){
  const jokeEl = document.getElementById('joke');
  const sourceEl = document.getElementById('source');
  const catEl = document.getElementById('category');
  const loadingEl = document.getElementById('loading');
  const btn = document.getElementById('newBtn');
  const ttsBtn = document.getElementById('ttsBtn');
  const copyBtn = document.getElementById('copyBtn');
  const tweetBtn = document.getElementById('tweetBtn');
  const cat = document.getElementById('cat');
  const safe = document.getElementById('safe');

  const offlineJokes = [
    "Why do programmers prefer dark mode? Because light attracts bugs.",
    "I told my computer I needed a break, and it said: 'No problem ‚Äî I'll go to sleep.'",
    "There are 10 types of people in the world: those who understand binary and those who don't.",
    "Debugging: Being the detective in a crime movie where you are also the murderer.",
    "My Wi‚ÄëFi and I have a special connection ‚Äî it drops me when I need it most."
  ];

  function showLoading(yes){ loadingEl.classList.toggle('hidden', !yes); btn.disabled = !!yes; }

  function setJoke(text, meta={}){
    jokeEl.textContent = text;
    sourceEl.textContent = `Source: ${meta.source||'‚Äî'}`;
    catEl.textContent = `Category: ${meta.category||'‚Äî'}`;
  }

  async function fetchFromJokeAPI(){
    const blacklist = safe.checked ? 'nsfw,religious,political,sexist,explicit' : '';
    const base = 'https://v2.jokeapi.dev/joke/';
    const url = `${base}${encodeURIComponent(cat.value)}?type=twopart, single${blacklist?`&blacklistFlags=${blacklist}`:''}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('JokeAPI failed');
    const data = await res.json();
    if(data.type === 'single'){
      return { text: data.joke, category: data.category, source: 'JokeAPI' };
    } else {
      return { text: `${data.setup} ${data.delivery}`, category: data.category, source: 'JokeAPI' };
    }
  }

  async function fetchFromDadJoke(){
    const res = await fetch('https://icanhazdadjoke.com/', { headers: { 'Accept': 'application/json' } });
    if(!res.ok) throw new Error('icanhazdadjoke failed');
    const data = await res.json();
    return { text: data.joke, category: 'Dad Joke', source: 'icanhazdadjoke' };
  }

  async function getJoke(){
    showLoading(true);
    try{
      // Try primary source
      const j1 = await fetchFromJokeAPI();
      setJoke(j1.text, j1);
    }catch(e1){
      try{
        const j2 = await fetchFromDadJoke();
        setJoke(j2.text, j2);
      }catch(e2){
        const text = offlineJokes[Math.floor(Math.random()*offlineJokes.length)];
        setJoke(text, {source:'Offline list', category:'Misc'});
      }
    } finally {
      showLoading(false);
    }
  }

  function speak(){
    const s = window.speechSynthesis; if(!s) return alert('Speech not supported on this browser.');
    s.cancel();
    const ut = new SpeechSynthesisUtterance(jokeEl.textContent);
    ut.rate = 1; ut.pitch = 1; ut.lang = navigator.language || 'en-US';
    s.speak(ut);
  }

  function copy(){
    navigator.clipboard.writeText(jokeEl.textContent).then(()=>{
      copyBtn.textContent = '‚úÖ Copied'; setTimeout(()=>copyBtn.textContent='üìã Copy', 1200);
    }).catch(()=> alert('Copy failed'));
  }

  function tweet(){
    const text = encodeURIComponent(jokeEl.textContent);
    const url = `https://twitter.com/intent/tweet?text=${text}`;
    window.open(url, '_blank');
  }

  btn.addEventListener('click', getJoke);
  ttsBtn.addEventListener('click', speak);
  copyBtn.addEventListener('click', copy);
  tweetBtn.addEventListener('click', tweet);

  // Load a joke immediately
  getJoke();
})();
</script>
</body>
</html>
